/**
 * Angular Tag Cloud (https://github.com/angular-tag-cloud)
 * Author: Zeeshan Hyder (https://github.com/zeeshanhyder)
 * Ported from: lucaong jQCloud (https://github.com/lucaong/jQCloud)
 *
 * Description:
 * Hello. This is the tag cloud library based in Angular and pure Javascript. It has no external dependencies. The library is ported from
 * lucaong's  jQCloud(github link above). His library is based in jQuery and is a core dependency, where as this library is independent and needs  * no external dependency. Please feel free to use this code and modify it according to your own wish.
 *
 *
 * Thankyou.
 */
var ngTagCloud=angular.module("ngTagCloud",[])
ngTagCloud.directive("ngTagCloud",["$timeout","$log",function(e,t){return{restrict:"EA",scope:{cloudWidth:"=?",cloudHeight:"=?",cloudOverflow:"=?",cloudData:"="},template:"<div id='ng-tag-cloud' class='ng-tag-cloud'></div>",link:function(o,a,n){if(""===o.cloudData||void 0===o.cloudData)return void t.error("ng-tag-cloud: No data passed. Please pass tags data as json. <ng-tag-cloud cloud-data='tagsJSON'></ng-tag-cloud\nFor more info see here: https://github.com/zeeshanhyder/angular-tag-cloud")
o.$watchCollection("[cloudData]",function(){e(function(){h(),l()},10)})
var i={width:o.cloudWidth?o.cloudWidth:"300",height:o.cloudHeight?o.cloudHeight:"300"},r=angular.element(a)[0],d=(r.getAttribute("id")||Math.floor(1e6*Math.random()).toString(36),[]),h=function(){d=o.cloudData,r.style.width=i.width+"px",r.style.height=i.height+"px"
var e={width:r.offsetWidth,height:r.offsetHeight,center:{x:i.width/2,y:i.height/2},delayedMode:d.length>50,shape:!1,encodeURI:!0,removeOverflowing:!o.cloudOverflow}
i=angular.extend(e,i||{})}
h(),"static"!==r.style.position&&""!==r.style.position||"relative"===r.style.position
var l=function(){a.empty()
for(var t=function(e,t){var o=function(e,t){return Math.abs(2*e.offsetLeft+e.offsetWidth-2*t.offsetLeft-t.offsetWidth)<e.offsetWidth+t.offsetWidth&&Math.abs(2*e.offsetTop+e.offsetHeight-2*t.offsetTop-t.offsetHeight)<e.offsetHeight+t.offsetHeight},a=0
for(a=0;a<t.length;a++)if(o(e,t[a]))return!0
return!1},o=0;o<d.length;o++)d[o].weight=parseFloat(d[o].weight,10)
d.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})
var n="rectangular"===i.shape?18:2,h=[],l=i.width/i.height,f=function(e,o){var a,f=6.28*Math.random(),c=0,s=0,g=0,u=5
d[0].weight>d[d.length-1].weight&&(u=Math.round((o.weight-d[d.length-1].weight)/(d[0].weight-d[d.length-1].weight)*9)+1),a=document.createElement("span"),a.className="w"+u
var p=document.createTextNode(o.text)
if(void 0!==o.link&&""!==o.link){if("string"==typeof o.link)var v=o.link
i.encodeURI&&(v=encodeURI(v).replace(/'/g,"%27"))
var w=document.createElement("a")
w.href=v,w.appendChild(p),a.appendChild(w)}else a.appendChild(p)
if(o.handlers)for(var m in o.handlers)o.handlers.hasOwnProperty(m)&&"function"==typeof o.handlers[m]&&a.addEventListener(m,o.handlersp[m])
r.appendChild(a)
var y=a.offsetWidth,M=a.offsetHeight,C=i.center.x-y/2,x=i.center.y-M/2,W=a.style
for(W.position="absolute",W.left=C+"px",W.top=x+"px";t(a,h);){if("rectangular"===i.shape)switch(s++,s*n>(1+Math.floor(g/2))*n*(g%4%2===0?1:l)&&(s=0,g++),g%4){case 1:C+=n*l+2*Math.random()
break
case 2:x-=n+2*Math.random()
break
case 3:C-=n*l+2*Math.random()
break
case 0:x+=n+2*Math.random()}else c+=n,f+=(e%2===0?1:-1)*n,C=i.center.x-y/2+c*Math.cos(f)*l,x=i.center.y+c*Math.sin(f)-M/2
W.left=C+"px",W.top=x+"px"}return i.removeOverflowing&&(C<0||x<0||C+y>i.width||x+M>i.height)?void a.remove():(h.push(a),void("function"==typeof o.afterWordRender&&o.afterWordRender.call(a)))},c=function(t){return t=t||0,r.offsetWidth<=0&&r.offsetHeight<=0?void e(function(){c(t)},10):void(t<d.length?(f(t,d[t]),e(function(){c(t+1)},10)):"function"==typeof i.afterCloudRender&&i.afterCloudRender.call(r))}
i.delayedMode?c():(d.forEach(function(e,t){f(t,e)}),"function"==typeof i.afterCloudRender&&i.afterCloudRender.call(r))}
e(function(){l()},10)},replace:!0}}])
