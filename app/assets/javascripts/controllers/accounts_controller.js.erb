app.controller('AccountCtrl', function($scope, $http, $window){
    var location = document.location.pathname;
    var params = parse_url(location);

    if(params.accounts) {
        $http.get(Routes.account_path(params.accounts, {format: "json"})).
        then(function (response) {
            $scope.account = response.data;
            $scope.action = $scope.account.id ? 'PATCH' : 'POST';
        });
    }


    $scope.submit = function(form) {
        $scope.$submitted = true;

        if(form.$invalid) {
            Materialize.toast('Form is invalid' , 1000);
            return;
        }

        $http({
            method : $scope.action,
            url : Routes.account_path($scope.account.id ? $scope.account.id : ''),
            data : { account: $scope.account }
        })
            .then(function (response) {
                Materialize.toast('Status' + response.status, 1000);
                $window.location.href = Routes.edit_user_path(response.data.redirect_to.id);
            }, function(data){
                Materialize.toast(data.status, 1000);
                console.log(data);
            });
    };

    $scope.login = function(form) {
        $scope.$submitted = true;

        if(form.$invalid) {
            Materialize.toast('Form is invalid' , 1000);
            return;
        }

        $http({
            method : 'POST',
            url : Routes.sessions_path(),
            data : {'account': $scope.account}
        })
            .then(function (response) {
                Materialize.toast('Status' + response.status, 1000);
                $window.location.href = '/';
            }, function(data){
                Materialize.toast(data.status, 1000);
            });
    }

});