app.controller('CommentsCtrl', function($scope, $http, ActionCableChannel){

    $scope.comment = {};


    var consumer = new ActionCableChannel("CommentsChannel", {'modal_id': $scope.photo.id});
    var callback = function(comment){
        $scope.photo.comments.push(comment);
        $scope.commentText = "";
    };
    consumer.subscribe(callback).then(function(){
        $scope.sendToCommentsChannel = function(message){
            comment = {};
            comment.text = message;
            comment.photo_id = $scope.photo.id;
            comment.user_id = 1;
            consumer.send(comment);
        };
        $scope.$on("$destroy", function(){
            consumer.unsubscribe().then(function(){ $scope.sendToCommentsChannel = undefined; });
        });
    });

});